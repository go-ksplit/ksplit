version: 2.1

orbs:
  codecov: codecov/codecov@3.2.2
jobs:
  test:
    docker:
    - image: circleci/golang:1.17
    working_directory: /go/src/github.com/go-ksplit/ksplit
    steps:
    - checkout
    - run:
        name: go test
        command: |
          make citest
    - codecov/upload:
        file: .state/coverage.out
    - run:
        name: build
        command: |
          make build

workflows:
  version: 2

  unstable:
    jobs:
    - test
